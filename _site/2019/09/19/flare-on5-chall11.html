<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Flare-on6 challenge 11 | HOME</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Flare-on6 challenge 11" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Please read the disclaimer" />
<meta property="og:description" content="Please read the disclaimer" />
<link rel="canonical" href="http://localhost:4000/2019/09/19/flare-on5-chall11.html" />
<meta property="og:url" content="http://localhost:4000/2019/09/19/flare-on5-chall11.html" />
<meta property="og:site_name" content="HOME" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-19T08:17:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Flare-on6 challenge 11" />
<script type="application/ld+json">
{"description":"Please read the disclaimer","@type":"BlogPosting","headline":"Flare-on6 challenge 11","dateModified":"2019-09-19T08:17:00-05:00","datePublished":"2019-09-19T08:17:00-05:00","url":"http://localhost:4000/2019/09/19/flare-on5-chall11.html","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2019/09/19/flare-on5-chall11.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="HOME" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">HOME</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/contact/">Contact</a><a class="page-link" href="/quotes/">Quotes</a><a class="page-link" href="/resources/">Training resources</a><a class="page-link" href="/disclaimer/">Disclaimer</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Flare-on6 challenge 11</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-09-19T08:17:00-05:00" itemprop="datePublished">Sep 19, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="please-read-the-disclaimer">Please read the <a href="/disclaimer/">disclaimer</a></h2>

<p>#vv_max:
                    Hey, at least its not subleq.</p>

<h2 id="analyses">Analyses</h2>

<p>We are given a 64bit Windows executable, the binary is expecting 2 string arguments.</p>

<p><img src="/assets/img/flare-on6/chall11/arguments.png" alt="arguments" /></p>

<p>after that we have 3 important functions.</p>

<p><img src="/assets/img/flare-on6/chall11/3_important_functions.png" alt="3_important_functions" /></p>

<h3 id="1-set_funcs_in_array">1) set_funcs_in_array:</h3>

<p>Populates an array with 24 different function addresses.</p>

<p><img src="/assets/img/flare-on6/chall11/funcs_array.png" alt="funcs_array" /></p>

<h3 id="2-run_vm">2) run_vm:</h3>

<p>Runs the vm engine.</p>

<p><img src="/assets/img/flare-on6/chall11/vm_engine.png" alt="vm_engine" /></p>

<h3 id="3-check_result_vm">3) check_result_vm:</h3>

<p>1- Compares 2 strings generated by the vm.
2- Checks if the first argument is equal to <strong><code class="language-plaintext highlighter-rouge">FLARE2019</code></strong>
3- Xor a string generated by the vm with a hardcoded string.</p>

<h2 id="tracing-the-vm">Tracing the vm</h2>

<p>The simplest approach to understand how a virtual machine protection works is to understand the functionality of each custom opcode of the vm, then dynamically tracing it’s arguments and it’s output (if required).</p>

<p>To do so I added breakpoints before and after the execution of each custom opcode to retrieve the arguments and the result using IDAPython.</p>

<p>for example:</p>

<p><img src="/assets/img/flare-on6/chall11/example_bps.png" alt="example_bps" /></p>

<p>the resulting log file was something as follow:</p>

<p><img src="/assets/img/flare-on6/chall11/script_output.png" alt="script_output" /></p>

<p>after a deep analysis and a backward tracing (form the result to the original data) the hash generated from the second argument, I came up with the following algorithm</p>

<p><img src="/assets/img/flare-on6/chall11/input_alteration.png" alt="input_alteration" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Note: It is not needed to understand the algorithm that uses the first argument, as it has to be "FLARE2019"
</code></pre></div></div>

<p>Knowing the resulting hash from “FLARE2019” after executing the vm is: <strong>7070b2ac01d25e610aa72aa8081c861ae845c829b2f3a11e0000000000000000</strong>, and that both hashes generated hashes must be equal, we can just reverse the second algorithm and give it the known hash to retrieve the right input for the second argument.</p>

<p>script here</p>

<p><img src="/assets/img/flare-on6/chall11/flags_output.png" alt="flags_output" /></p>

<p>With some fails and tries I was able to retrieve the flag which is: <strong><code class="language-plaintext highlighter-rouge">AVX5_VM_M4K3S_BASE64_C0MPL1C4T3D@flare-on.com</code></strong></p>


  </div><a class="u-url" href="/2019/09/19/flare-on5-chall11.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
        <ul class="contact-list">
          <li class="p-name"><ul class="social-media-list"><li><a href="https://github.com/soolidsnake"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">soolidsnake</span></a></li></ul>
</br>
          <li class="p-name">
            <p>All tasks and writeups are copyrighted by their author. All images and the logo are copyrighted by me. If you would like to use them, please contact me :)</p>
        </ul>
    </div>

  </div>

</footer>
</body>

</html>
